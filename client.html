<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fund78 Client</title>
</head>
<body>
    <h1>Fund78 Client</h1>

    <!-- HTTP Section -->
    <div>
        <h2>HTTP POST /visitor</h2>
        <input type="text" id="httpTopic" placeholder="Topic (e.g., LOGON)" value="LOGON">
        <input type="text" id="httpPayload" placeholder="Payload (e.g., alice)" value="alice">
        <button onclick="sendHTTP()">Send HTTP</button>
        <pre id="httpResponse"></pre>
    </div>

    <hr>

    <!-- WebSocket Section -->
    <div>
        <h2>WebSocket /ws</h2>
        <button onclick="connectWS()">Connect</button>
        <button onclick="disconnectWS()">Disconnect</button>
        <div id="wsStatus">Disconnected</div>
        <br>
        <input type="text" id="wsTopic" placeholder="Topic (e.g., TICK)" value="TICK">
        <input type="text" id="wsPayload" placeholder="Payload (e.g., 12345)" value="12345">
        <button onclick="sendWS()">Send WebSocket</button>
        <pre id="wsLog"></pre>
    </div>

    <script>
        let ws = null;

        // HTTP Functions
        async function sendHTTP() {
            const topic = document.getElementById('httpTopic').value;
            const payload = document.getElementById('httpPayload').value;

            try {
                const response = await fetch('http://localhost:8081/visitor', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ topic, payload })
                });

                const data = await response.json();
                document.getElementById('httpResponse').textContent =
                    `Status: ${response.status}\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                document.getElementById('httpResponse').textContent = `Error: ${error.message}`;
            }
        }

        // WebSocket Functions
        function connectWS() {
            if (ws) {
                document.getElementById('wsStatus').textContent = 'Already connected';
                return;
            }

            ws = new WebSocket('ws://localhost:8082/ws');

            ws.onopen = () => {
                document.getElementById('wsStatus').textContent = 'Connected';
                addLog('Connected to WebSocket');
            };

            ws.onclose = () => {
                document.getElementById('wsStatus').textContent = 'Disconnected';
                addLog('Disconnected from WebSocket');
                ws = null;
            };

            ws.onerror = (error) => {
                addLog(`Error: ${error}`);
            };

            ws.onmessage = (event) => {
                addLog(`Received: ${event.data}`);
            };
        }

        function disconnectWS() {
            if (ws) {
                ws.close();
            }
        }

        function sendWS() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                addLog('Not connected. Click Connect first.');
                return;
            }

            const topic = document.getElementById('wsTopic').value;
            const payload = document.getElementById('wsPayload').value;
            const message = JSON.stringify({ topic, payload });

            ws.send(message);
            addLog(`Sent: ${message}`);
        }

        function addLog(message) {
            const log = document.getElementById('wsLog');
            const timestamp = new Date().toLocaleTimeString();
            log.textContent += `[${timestamp}] ${message}\n`;
        }
    </script>
</body>
</html>
